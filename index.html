<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub de Jeux</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <div id="app" class="flex items-center justify-center min-h-screen p-4"></div>

    <script>
        let currentGame = null;
        let gameState = {};

        // Morpion
        const TicTacToe = {
            init() {
                gameState.board = Array(9).fill(null);
                gameState.isXNext = true;
                gameState.score = { X: 0, O: 0, draws: 0 };
            },
            
            calculateWinner(squares) {
                const lines = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8],
                    [0, 3, 6], [1, 4, 7], [2, 5, 8],
                    [0, 4, 8], [2, 4, 6]
                ];
                
                for (let line of lines) {
                    const [a, b, c] = line;
                    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
                        return { winner: squares[a], line };
                    }
                }
                return null;
            },
            
            handleClick(i) {
                if (gameState.board[i] || this.calculateWinner(gameState.board)) return;
                
                gameState.board[i] = gameState.isXNext ? 'X' : 'O';
                gameState.isXNext = !gameState.isXNext;
                
                const result = this.calculateWinner(gameState.board);
                if (result) {
                    setTimeout(() => {
                        gameState.score[result.winner]++;
                        render();
                    }, 500);
                } else if (gameState.board.every(cell => cell !== null)) {
                    setTimeout(() => {
                        gameState.score.draws++;
                        render();
                    }, 500);
                }
                
                render();
            },
            
            reset() {
                gameState.board = Array(9).fill(null);
                gameState.isXNext = true;
                render();
            },
            
            render() {
                const result = this.calculateWinner(gameState.board);
                const winner = result?.winner;
                const winningLine = result?.line || [];
                const isDraw = !winner && gameState.board.every(cell => cell !== null);
                
                const status = winner 
                    ? `üéâ Joueur ${winner} gagne !`
                    : isDraw 
                    ? 'ü§ù Match nul !'
                    : `üéÆ Au tour de : ${gameState.isXNext ? 'X' : 'O'}`;
                
                return `
                    <div class="w-full max-w-2xl mx-auto">
                        <div class="flex justify-center gap-4 mb-6">
                            <div class="bg-blue-500/30 backdrop-blur px-4 py-2 rounded-xl border border-blue-300/30">
                                <div class="text-blue-200 text-xs font-semibold">X</div>
                                <div class="text-2xl font-bold text-white">${gameState.score.X}</div>
                            </div>
                            <div class="bg-gray-500/30 backdrop-blur px-4 py-2 rounded-xl border border-gray-300/30">
                                <div class="text-gray-200 text-xs font-semibold">Nuls</div>
                                <div class="text-2xl font-bold text-white">${gameState.score.draws}</div>
                            </div>
                            <div class="bg-pink-500/30 backdrop-blur px-4 py-2 rounded-xl border border-pink-300/30">
                                <div class="text-pink-200 text-xs font-semibold">O</div>
                                <div class="text-2xl font-bold text-white">${gameState.score.O}</div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <div class="text-xl font-bold text-white bg-white/10 backdrop-blur py-2 px-4 rounded-xl inline-block">
                                ${status}
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-2 mb-4 max-w-md mx-auto">
                            ${gameState.board.map((cell, i) => {
                                const isWinningCell = winningLine.includes(i);
                                return `
                                    <button
                                        onclick="TicTacToe.handleClick(${i})"
                                        class="w-24 h-24 text-5xl font-bold rounded-xl transition-all
                                            ${cell === 'X' ? 'text-blue-400' : 'text-pink-400'}
                                            ${isWinningCell 
                                                ? 'bg-green-500/40 border-2 border-green-300 scale-105' 
                                                : 'bg-white/10 border-2 border-white/30 hover:bg-white/20 hover:scale-105'
                                            }
                                            backdrop-blur shadow-lg"
                                        ${cell || winner ? 'disabled' : ''}
                                    >
                                        ${cell || ''}
                                    </button>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="flex gap-3 justify-center">
                            <button onclick="TicTacToe.reset()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-xl transition-all hover:scale-105">
                                Nouvelle partie
                            </button>
                        </div>
                    </div>
                `;
            }
        };

        // Puissance 4
        const ConnectFour = {
            init() {
                gameState.board = Array(42).fill(null);
                gameState.isRedNext = true;
                gameState.score = { red: 0, yellow: 0 };
            },
            
            checkWinner(squares) {
                const rows = 6, cols = 7;
                
                // Horizontal
                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols - 3; c++) {
                        const idx = r * cols + c;
                        if (squares[idx] && squares[idx] === squares[idx + 1] && 
                            squares[idx] === squares[idx + 2] && squares[idx] === squares[idx + 3]) {
                            return { winner: squares[idx], cells: [idx, idx + 1, idx + 2, idx + 3] };
                        }
                    }
                }
                
                // Vertical
                for (let c = 0; c < cols; c++) {
                    for (let r = 0; r < rows - 3; r++) {
                        const idx = r * cols + c;
                        if (squares[idx] && squares[idx] === squares[idx + cols] && 
                            squares[idx] === squares[idx + cols * 2] && squares[idx] === squares[idx + cols * 3]) {
                            return { winner: squares[idx], cells: [idx, idx + cols, idx + cols * 2, idx + cols * 3] };
                        }
                    }
                }
                
                // Diagonales
                for (let r = 0; r < rows - 3; r++) {
                    for (let c = 0; c < cols - 3; c++) {
                        const idx = r * cols + c;
                        if (squares[idx] && squares[idx] === squares[idx + cols + 1] && 
                            squares[idx] === squares[idx + (cols + 1) * 2] && squares[idx] === squares[idx + (cols + 1) * 3]) {
                            return { winner: squares[idx], cells: [idx, idx + cols + 1, idx + (cols + 1) * 2, idx + (cols + 1) * 3] };
                        }
                    }
                }
                
                for (let r = 0; r < rows - 3; r++) {
                    for (let c = 3; c < cols; c++) {
                        const idx = r * cols + c;
                        if (squares[idx] && squares[idx] === squares[idx + cols - 1] && 
                            squares[idx] === squares[idx + (cols - 1) * 2] && squares[idx] === squares[idx + (cols - 1) * 3]) {
                            return { winner: squares[idx], cells: [idx, idx + cols - 1, idx + (cols - 1) * 2, idx + (cols - 1) * 3] };
                        }
                    }
                }
                
                return null;
            },
            
            dropPiece(col) {
                const result = this.checkWinner(gameState.board);
                if (result) return;
                
                for (let row = 5; row >= 0; row--) {
                    const idx = row * 7 + col;
                    if (!gameState.board[idx]) {
                        gameState.board[idx] = gameState.isRedNext ? 'red' : 'yellow';
                        gameState.isRedNext = !gameState.isRedNext;
                        
                        const winner = this.checkWinner(gameState.board);
                        if (winner) {
                            setTimeout(() => {
                                gameState.score[winner.winner]++;
                                render();
                            }, 500);
                        }
                        
                        render();
                        return;
                    }
                }
            },
            
            reset() {
                gameState.board = Array(42).fill(null);
                gameState.isRedNext = true;
                render();
            },
            
            render() {
                const result = this.checkWinner(gameState.board);
                const winningCells = result?.cells || [];
                
                return `
                    <div class="w-full max-w-2xl mx-auto">
                        <div class="flex justify-center gap-6 mb-6">
                            <div class="bg-red-500/30 backdrop-blur px-6 py-2 rounded-xl border border-red-300/30">
                                <div class="text-red-200 text-sm font-semibold">Rouge</div>
                                <div class="text-2xl font-bold text-white">${gameState.score.red}</div>
                            </div>
                            <div class="bg-yellow-500/30 backdrop-blur px-6 py-2 rounded-xl border border-yellow-300/30">
                                <div class="text-yellow-200 text-sm font-semibold">Jaune</div>
                                <div class="text-2xl font-bold text-white">${gameState.score.yellow}</div>
                            </div>
                        </div>
                        
                        <div class="text-center mb-4">
                            <div class="text-xl font-bold text-white bg-white/10 backdrop-blur py-2 px-4 rounded-xl inline-block">
                                ${result ? `üéâ ${result.winner === 'red' ? 'Rouge' : 'Jaune'} gagne !` : `Au tour de : ${gameState.isRedNext ? 'üî¥ Rouge' : 'üü° Jaune'}`}
                            </div>
                        </div>
                        
                        <div class="bg-blue-800/50 backdrop-blur p-4 rounded-2xl border-4 border-blue-900 mb-4">
                            <div class="grid grid-cols-7 gap-2">
                                ${gameState.board.map((cell, i) => {
                                    const isWinning = winningCells.includes(i);
                                    return `
                                        <button
                                            onclick="ConnectFour.dropPiece(${i % 7})"
                                            class="w-14 h-14 rounded-full transition-all ${
                                                cell === 'red' ? 'bg-red-500' : 
                                                cell === 'yellow' ? 'bg-yellow-400' : 
                                                'bg-white/20'
                                            } ${isWinning ? 'ring-4 ring-green-400 scale-110' : ''} ${!cell && !result ? 'hover:bg-white/30 cursor-pointer' : ''}"
                                        ></button>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="ConnectFour.reset()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-xl transition-all hover:scale-105">
                                Nouvelle partie
                            </button>
                        </div>
                    </div>
                `;
            }
        };

        // Snake
        const Snake = {
            init() {
                gameState.snake = [[5, 5]];
                gameState.food = [10, 10];
                gameState.direction = 'RIGHT';
                gameState.gameOver = false;
                gameState.score = 0;
                gameState.highScore = 0;
                gameState.started = false;
                
                document.addEventListener('keydown', this.handleKeyPress.bind(this));
                
                if (gameState.interval) clearInterval(gameState.interval);
                gameState.interval = setInterval(() => this.moveSnake(), 150);
            },
            
            generateFood(snakeBody) {
                let newFood;
                do {
                    newFood = [
                        Math.floor(Math.random() * 20),
                        Math.floor(Math.random() * 20)
                    ];
                } while (snakeBody.some(seg => seg[0] === newFood[0] && seg[1] === newFood[1]));
                return newFood;
            },
            
            moveSnake() {
                if (gameState.gameOver || !gameState.started) return;
                
                const head = [...gameState.snake[0]];
                
                switch (gameState.direction) {
                    case 'UP': head[0]--; break;
                    case 'DOWN': head[0]++; break;
                    case 'LEFT': head[1]--; break;
                    case 'RIGHT': head[1]++; break;
                }
                
                if (head[0] < 0 || head[0] >= 20 || head[1] < 0 || head[1] >= 20 ||
                    gameState.snake.some(seg => seg[0] === head[0] && seg[1] === head[1])) {
                    gameState.gameOver = true;
                    if (gameState.score > gameState.highScore) {
                        gameState.highScore = gameState.score;
                    }
                    render();
                    return;
                }
                
                const newSnake = [head, ...gameState.snake];
                
                if (head[0] === gameState.food[0] && head[1] === gameState.food[1]) {
                    gameState.score += 10;
                    gameState.food = this.generateFood(newSnake);
                } else {
                    newSnake.pop();
                }
                
                gameState.snake = newSnake;
                render();
            },
            
            handleKeyPress(e) {
                if (!gameState.started) {
                    gameState.started = true;
                }
                
                const key = e.key;
                if (key === 'ArrowUp' && gameState.direction !== 'DOWN') gameState.direction = 'UP';
                if (key === 'ArrowDown' && gameState.direction !== 'UP') gameState.direction = 'DOWN';
                if (key === 'ArrowLeft' && gameState.direction !== 'RIGHT') gameState.direction = 'LEFT';
                if (key === 'ArrowRight' && gameState.direction !== 'LEFT') gameState.direction = 'RIGHT';
            },
            
            reset() {
                this.init();
                render();
            },
            
            render() {
                const gridSize = 20;
                
                return `
                    <div class="w-full max-w-2xl mx-auto">
                        <div class="flex justify-center gap-6 mb-4">
                            <div class="bg-green-500/30 backdrop-blur px-6 py-2 rounded-xl border border-green-300/30">
                                <div class="text-green-200 text-xs font-semibold">Score</div>
                                <div class="text-2xl font-bold text-white">${gameState.score}</div>
                            </div>
                            <div class="bg-purple-500/30 backdrop-blur px-6 py-2 rounded-xl border border-purple-300/30">
                                <div class="text-purple-200 text-xs font-semibold">Record</div>
                                <div class="text-2xl font-bold text-white">${gameState.highScore}</div>
                            </div>
                        </div>
                        
                        ${!gameState.started ? '<div class="text-center mb-4 text-white text-sm">Utilisez les fl√®ches du clavier pour commencer</div>' : ''}
                        
                        ${gameState.gameOver ? `<div class="text-center mb-4"><div class="text-xl font-bold text-red-400 bg-red-500/20 backdrop-blur py-2 px-4 rounded-xl inline-block">Game Over ! Score: ${gameState.score}</div></div>` : ''}
                        
                        <div class="bg-gray-900/50 backdrop-blur p-2 rounded-xl border-2 border-white/20 mb-4">
                            <div class="grid gap-0.5" style="grid-template-columns: repeat(${gridSize}, 1fr)">
                                ${Array.from({ length: gridSize * gridSize }).map((_, i) => {
                                    const row = Math.floor(i / gridSize);
                                    const col = i % gridSize;
                                    const isSnake = gameState.snake.some(seg => seg[0] === row && seg[1] === col);
                                    const isHead = gameState.snake[0][0] === row && gameState.snake[0][1] === col;
                                    const isFood = gameState.food[0] === row && gameState.food[1] === col;
                                    
                                    return `<div class="aspect-square rounded-sm ${
                                        isHead ? 'bg-green-400' :
                                        isSnake ? 'bg-green-600' :
                                        isFood ? 'bg-red-500' :
                                        'bg-gray-800/30'
                                    }"></div>`;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="Snake.reset()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-xl transition-all hover:scale-105">
                                Nouvelle partie
                            </button>
                        </div>
                    </div>
                `;
            }
        };

        // Menu principal
        function showMenu() {
            currentGame = null;
            if (gameState.interval) {
                clearInterval(gameState.interval);
            }
            render();
        }

        function selectGame(game) {
            currentGame = game;
            
            if (game === 'tictactoe') TicTacToe.init();
            else if (game === 'connect4') ConnectFour.init();
            else if (game === 'snake') Snake.init();
            
            render();
        }

        function render() {
            const app = document.getElementById('app');
            
            if (!currentGame) {
                app.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-12 shadow-2xl border border-white/20 max-w-4xl w-full">
                        <h1 class="text-6xl font-bold text-white text-center mb-4 drop-shadow-lg">
                            üéÆ Hub de Jeux
                        </h1>
                        <p class="text-white/70 text-center mb-12 text-lg">
                            Choisissez votre jeu pr√©f√©r√©
                        </p>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <button onclick="selectGame('tictactoe')" class="bg-gradient-to-br from-purple-500 to-pink-500 p-8 rounded-2xl shadow-xl hover:scale-105 transition-all duration-300 border-2 border-white/30">
                                <div class="text-6xl mb-4">‚ùå‚≠ï</div>
                                <div class="text-2xl font-bold text-white">Morpion</div>
                            </button>
                            
                            <button onclick="selectGame('connect4')" class="bg-gradient-to-br from-blue-500 to-cyan-500 p-8 rounded-2xl shadow-xl hover:scale-105 transition-all duration-300 border-2 border-white/30">
                                <div class="text-6xl mb-4">üî¥üü°</div>
                                <div class="text-2xl font-bold text-white">Puissance 4</div>
                            </button>
                            
                            <button onclick="selectGame('snake')" class="bg-gradient-to-br from-green-500 to-emerald-500 p-8 rounded-2xl shadow-xl hover:scale-105 transition-all duration-300 border-2 border-white/30">
                                <div class="text-6xl mb-4">üêç</div>
                                <div class="text-2xl font-bold text-white">Snake</div>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                const gameName = currentGame === 'tictactoe' ? 'Morpion' : 
                                 currentGame === 'connect4' ? 'Puissance 4' : 'Snake';
                
                let gameContent = '';
                if (currentGame === 'tictactoe') gameContent = TicTacToe.render();
                else if (currentGame === 'connect4') gameContent = ConnectFour.render();
                else if (currentGame === 'snake') gameContent = Snake.render();
                
                app.innerHTML = `
                    <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl border border-white/20 w-full max-w-4xl">
                        <div class="flex items-center justify-between mb-6">
                            <button onclick="showMenu()" class="bg-white/10 hover:bg-white/20 text-white font-semibold py-2 px-4 rounded-xl transition-all">
                                ‚Üê Retour
                            </button>
                            <h1 class="text-3xl font-bold text-white">
                                ${gameName}
                            </h1>
                            <div class="w-24"></div>
                        </div>
                        
                        ${gameContent}
                    </div>
                `;
            }
        }

        // D√©marrage
        render();
    </script>
</body>
</html>
